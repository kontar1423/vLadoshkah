<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω—ã—Ö –∏ –ø—Ä–∏—é—Ç–æ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        
        .form-section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
            font-size: 14px;
            display: block;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            box-sizing: border-box;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #007bff;
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .submit-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
            width: 100%;
        }
        
        .submit-btn:hover {
            background: #0056b3;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #28a745;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #dc3545;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .photo-upload {
            border: 2px dashed #007bff;
            padding: 20px;
            text-align: center;
            border-radius: 6px;
            background: #f8f9fa;
            margin-bottom: 15px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #dee2e6;
        }
        
        .tab {
            padding: 12px 25px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 16px;
            margin-right: 5px;
            border-radius: 6px 6px 0 0;
            transition: background 0.3s;
        }
        
        .tab.active {
            background: #007bff;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }

        .file-input {
            margin: 10px 0;
        }

        .preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .preview-item {
            position: relative;
            width: 100px;
            height: 100px;
        }

        .preview-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 6px;
        }

        .remove-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üêæ –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏—é—Ç–æ–º</h1>
        <p>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö –∏ –ø—Ä–∏—é—Ç–æ–≤</p>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="switchTab('animal')">–î–æ–±–∞–≤–∏—Ç—å –∂–∏–≤–æ—Ç–Ω–æ–µ</button>
        <button class="tab" onclick="switchTab('shelter')">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏—é—Ç</button>
        <button class="tab" onclick="switchTab('user')">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
        <button class="tab" onclick="switchTab('application')">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
    </div>

    <div id="animalForm" class="tab-content active">
        <div class="form-container">
            <div class="form-section">
                <h2>üìù –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ</h2>
                
                <div class="form-group">
                    <label for="animalName">–ò–º—è –∂–∏–≤–æ—Ç–Ω–æ–≥–æ *</label>
                    <input type="text" id="animalName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∂–∏–≤–æ—Ç–Ω–æ–≥–æ" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="animalAge">–í–æ–∑—Ä–∞—Å—Ç (–ª–µ—Ç) *</label>
                        <input type="number" id="animalAge" placeholder="0" min="0" max="50" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="animalType">–¢–∏–ø –∂–∏–≤–æ—Ç–Ω–æ–≥–æ *</label>
                        <select id="animalType" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                            <option value="cat">–ö–æ—à–∫–∞</option>
                            <option value="dog">–°–æ–±–∞–∫–∞</option>
                            <option value="rabbit">–ö—Ä–æ–ª–∏–∫</option>
                            <option value="parrot">–ü–æ–ø—É–≥–∞–π</option>
                            <option value="hamster">–•–æ–º—è–∫</option>
                            <option value="other">–î—Ä—É–≥–æ–µ</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="animalGender">–ü–æ–ª *</label>
                        <select id="animalGender" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª</option>
                            <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                            <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="animalWeight">–í–µ—Å (–∫–≥)</label>
                        <input type="number" id="animalWeight" placeholder="0.0" step="0.1" min="0">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="animalColor">–û–∫—Ä–∞—Å</label>
                        <input type="text" id="animalColor" placeholder="–û–∫—Ä–∞—Å –∂–∏–≤–æ—Ç–Ω–æ–≥–æ">
                    </div>
                    
                    <div class="form-group">
                        <label for="animalSize">–†–∞–∑–º–µ—Ä</label>
                        <select id="animalSize">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä</option>
                            <option value="small">–ú–∞–ª–µ–Ω—å–∫–∏–π</option>
                            <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
                            <option value="large">–ö—Ä—É–ø–Ω—ã–π</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="animalHealth">–°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è</label>
                    <input type="text" id="animalHealth" placeholder="–∑–¥–æ—Ä–æ–≤, —Ç—Ä–µ–±—É–µ—Ç –ª–µ—á–µ–Ω–∏—è –∏ —Ç.–¥.">
                </div>
                
                <div class="form-group">
                    <label for="animalPersonality">–•–∞—Ä–∞–∫—Ç–µ—Ä –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ</label>
                    <textarea id="animalPersonality" placeholder="–û–ø–∏—à–∏—Ç–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∂–∏–≤–æ—Ç–Ω–æ–≥–æ"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="animalHistory">–ò—Å—Ç–æ—Ä–∏—è</label>
                    <textarea id="animalHistory" placeholder="–û—Ç–∫—É–¥–∞ –ø–æ—è–≤–∏–ª–æ—Å—å –∂–∏–≤–æ—Ç–Ω–æ–µ, –µ–≥–æ –∏—Å—Ç–æ—Ä–∏—è"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="animalShelter">–ü—Ä–∏—é—Ç *</label>
                    <select id="animalShelter" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏—é—Ç</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ</label>
                    <div class="photo-upload">
                        <input type="file" id="animalPhotos" class="file-input" multiple accept="image/*">
                        <div id="animalPreview" class="preview-container"></div>
                        <small>–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ</small>
                    </div>
                </div>
                
                <button class="submit-btn" onclick="createAnimal()">–î–æ–±–∞–≤–∏—Ç—å –∂–∏–≤–æ—Ç–Ω–æ–µ</button>
            </div>
        </div>
    </div>

    <div id="shelterForm" class="tab-content">
        <div class="form-container">
            <div class="form-section">
                <h2>üè† –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–∏—é—Ç</h2>
                
                <div class="form-group">
                    <label for="shelterName">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏—é—Ç–∞ *</label>
                    <input type="text" id="shelterName" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏—é—Ç–∞" required>
                </div>
                
                <div class="form-group">
                    <label for="shelterAddress">–ê–¥—Ä–µ—Å *</label>
                    <input type="text" id="shelterAddress" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –ø—Ä–∏—é—Ç–∞" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="shelterPhone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" id="shelterPhone" placeholder="+7 (XXX) XXX-XX-XX">
                    </div>
                    
                    <div class="form-group">
                        <label for="shelterEmail">Email</label>
                        <input type="email" id="shelterEmail" placeholder="email@example.com">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="shelterHours">–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã</label>
                    <input type="text" id="shelterHours" placeholder="–ü–Ω-–ü—Ç 9:00-18:00">
                </div>
                
                <div class="form-group">
                    <label for="shelterDescription">–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏—é—Ç–∞</label>
                    <textarea id="shelterDescription" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–∏—é—Ç, –µ–≥–æ –º–∏—Å—Å–∏—é –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏"></textarea>
                </div>
                
                <div class="form-group">
                    <label>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø—Ä–∏—é—Ç–∞</label>
                    <div class="photo-upload">
                        <input type="file" id="shelterPhotos" class="file-input" multiple accept="image/*">
                        <div id="shelterPreview" class="preview-container"></div>
                        <small>–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ</small>
                    </div>
                </div>
                
                <button class="submit-btn" onclick="createShelter()">–°–æ–∑–¥–∞—Ç—å –ø—Ä–∏—é—Ç</button>
            </div>
        </div>
    </div>

    <div id="userForm" class="tab-content">
        <div class="form-container">
            <div class="form-section">
                <h2>üë§ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="userFirstName">–ò–º—è *</label>
                        <input type="text" id="userFirstName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="userLastName">–§–∞–º–∏–ª–∏—è *</label>
                        <input type="text" id="userLastName" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="userEmail">Email *</label>
                        <input type="email" id="userEmail" placeholder="email@example.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="userPhone">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                        <input type="tel" id="userPhone" placeholder="+7 (XXX) XXX-XX-XX" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="userAge">–í–æ–∑—Ä–∞—Å—Ç</label>
                        <input type="number" id="userAge" placeholder="0" min="18" max="100">
                    </div>
                    
                    <div class="form-group">
                        <label for="userGender">–ü–æ–ª</label>
                        <select id="userGender">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª</option>
                            <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                            <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                            <option value="other">–î—Ä—É–≥–æ–π</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="userAddress">–ê–¥—Ä–µ—Å</label>
                    <input type="text" id="userAddress" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å">
                </div>
                
                <div class="form-group">
                    <label for="userOccupation">–ü—Ä–æ—Ñ–µ—Å—Å–∏—è</label>
                    <input type="text" id="userOccupation" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é">
                </div>
                
                <div class="form-group">
                    <label for="userExperience">–û–ø—ã—Ç —Å –∂–∏–≤–æ—Ç–Ω—ã–º–∏</label>
                    <textarea id="userExperience" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à –æ–ø—ã—Ç —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –∂–∏–≤–æ—Ç–Ω—ã—Ö"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="userHousing">–ñ–∏–ª–∏—â–Ω—ã–µ —É—Å–ª–æ–≤–∏—è</label>
                    <textarea id="userHousing" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –∂–∏–ª–∏—â–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (–∫–≤–∞—Ä—Ç–∏—Ä–∞/–¥–æ–º, –ø–ª–æ—â–∞–¥—å, –µ—Å—Ç—å –ª–∏ –¥–≤–æ—Ä –∏ —Ç.–¥.)"></textarea>
                </div>
                
                <button class="submit-btn" onclick="createUser()">–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            </div>
        </div>
    </div>

    <div id="applicationForm" class="tab-content">
        <div class="form-container">
            <div class="form-section">
                <h2>üìã –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —É—Å—ã–Ω–æ–≤–ª–µ–Ω–∏–µ</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="applicationUser">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å *</label>
                        <select id="applicationUser" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="applicationAnimal">–ñ–∏–≤–æ—Ç–Ω–æ–µ *</label>
                        <select id="applicationAnimal" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∂–∏–≤–æ—Ç–Ω–æ–µ</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="applicationShelter">–ü—Ä–∏—é—Ç *</label>
                    <select id="applicationShelter" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏—é—Ç</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="applicationStatus">–°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ *</label>
                    <select id="applicationStatus" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å</option>
                        <option value="pending">–û–∂–∏–¥–∞–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è</option>
                        <option value="approved">–û–¥–æ–±—Ä–µ–Ω–∞</option>
                        <option value="rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω–∞</option>
                        <option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω–∞</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="applicationReason">–ü—Ä–∏—á–∏–Ω–∞ —É—Å—ã–Ω–æ–≤–ª–µ–Ω–∏—è</label>
                    <textarea id="applicationReason" placeholder="–ü–æ—á–µ–º—É –≤—ã —Ö–æ—Ç–∏—Ç–µ —É—Å—ã–Ω–æ–≤–∏—Ç—å —ç—Ç–æ –∂–∏–≤–æ—Ç–Ω–æ–µ?"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="applicationNotes">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏</label>
                    <textarea id="applicationNotes" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø—Ä–∏—é—Ç–∞"></textarea>
                </div>
                
                <button class="submit-btn" onclick="createApplication()">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
            </div>
        </div>
    </div>

    <div id="message"></div>

    <script>
        const API_BASE = 'http://localhost:4000/api';
        let animalPhotos = [];
        let shelterPhotos = [];

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏—é—Ç–æ–≤ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadShelters();
            setupPhotoUploads();
        });

        function setupPhotoUploads() {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ –¥–ª—è –∂–∏–≤–æ—Ç–Ω—ã—Ö
            document.getElementById('animalPhotos').addEventListener('change', function(e) {
                handlePhotoUpload(e, 'animal');
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ –¥–ª—è –ø—Ä–∏—é—Ç–æ–≤
            document.getElementById('shelterPhotos').addEventListener('change', function(e) {
                handlePhotoUpload(e, 'shelter');
            });
        }

        function handlePhotoUpload(event, entityType) {
            const files = Array.from(event.target.files);
            const previewContainer = document.getElementById(entityType + 'Preview');
            
            files.forEach(file => {
                if (!file.type.startsWith('image/')) {
                    showMessage('‚ùå –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'preview-item';
                    previewItem.innerHTML = `
                        <img src="${e.target.result}" class="preview-image">
                        <button type="button" class="remove-btn" onclick="removePhoto('${entityType}', '${file.name}')">√ó</button>
                    `;
                    previewContainer.appendChild(previewItem);

                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
                    if (entityType === 'animal') {
                        animalPhotos.push(file);
                    } else {
                        shelterPhotos.push(file);
                    }
                };
                reader.readAsDataURL(file);
            });

            // –û—á–∏—â–∞–µ–º input
            event.target.value = '';
        }

        function removePhoto(entityType, fileName) {
            const previewContainer = document.getElementById(entityType + 'Preview');
            const items = previewContainer.getElementsByClassName('preview-item');
            
            for (let item of items) {
                if (item.querySelector('img').src.includes(fileName)) {
                    item.remove();
                    break;
                }
            }

            // –£–¥–∞–ª—è–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞
            if (entityType === 'animal') {
                animalPhotos = animalPhotos.filter(file => file.name !== fileName);
            } else {
                shelterPhotos = shelterPhotos.filter(file => file.name !== fileName);
            }
        }

        async function loadShelters() {
            try {
                const response = await fetch(`${API_BASE}/shelters`);
                if (response.ok) {
                    const shelters = await response.json();
                    updateShelterSelect(shelters);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏—é—Ç–æ–≤:', error);
            }
        }

        async function loadUsers() {
            try {
                const response = await fetch(`${API_BASE}/users`);
                if (response.ok) {
                    const users = await response.json();
                    updateUserSelect(users);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
            }
        }

        async function loadAnimals() {
            try {
                const response = await fetch(`${API_BASE}/animals`);
                if (response.ok) {
                    const animals = await response.json();
                    updateAnimalSelect(animals);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∂–∏–≤–æ—Ç–Ω—ã—Ö:', error);
            }
        }

        function updateShelterSelect(shelters) {
            const select = document.getElementById('animalShelter');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏—é—Ç</option>';
            
            shelters.forEach(shelter => {
                const option = document.createElement('option');
                option.value = shelter.id;
                option.textContent = shelter.name;
                select.appendChild(option);
            });

            // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç –ø—Ä–∏—é—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–µ –∑–∞—è–≤–∫–∏
            const applicationShelterSelect = document.getElementById('applicationShelter');
            if (applicationShelterSelect) {
                applicationShelterSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏—é—Ç</option>';
                shelters.forEach(shelter => {
                    const option = document.createElement('option');
                    option.value = shelter.id;
                    option.textContent = shelter.name;
                    applicationShelterSelect.appendChild(option);
                });
            }
        }

        function updateUserSelect(users) {
            const select = document.getElementById('applicationUser');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>';
            
            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = `${user.first_name} ${user.last_name} (${user.email})`;
                select.appendChild(option);
            });
        }

        function updateAnimalSelect(animals) {
            const select = document.getElementById('applicationAnimal');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∂–∏–≤–æ—Ç–Ω–æ–µ</option>';
            
            animals.forEach(animal => {
                const option = document.createElement('option');
                option.value = animal.id;
                option.textContent = `${animal.name} (${animal.type}, ${animal.age} –ª–µ—Ç)`;
                select.appendChild(option);
            });
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Form').classList.add('active');
            event.target.classList.add('active');

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ñ–æ—Ä–º—ã –∑–∞—è–≤–∫–∏
            if (tabName === 'application') {
                loadUsers();
                loadAnimals();
                loadShelters(); // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏—é—Ç—ã –¥–ª—è –∑–∞—è–≤–∫–∏
            }
        }

        async function createAnimal() {
            const formData = {
                name: document.getElementById('animalName').value,
                age: parseInt(document.getElementById('animalAge').value),
                type: document.getElementById('animalType').value,
                gender: document.getElementById('animalGender').value,
                shelter_id: parseInt(document.getElementById('animalShelter').value),
                color: document.getElementById('animalColor').value,
                weight: document.getElementById('animalWeight').value ? parseFloat(document.getElementById('animalWeight').value) : null,
                animal_size: document.getElementById('animalSize').value,
                health: document.getElementById('animalHealth').value,
                personality: document.getElementById('animalPersonality').value,
                history: document.getElementById('animalHistory').value
            };

            if (!formData.name || !formData.age || !formData.type || !formData.gender || !formData.shelter_id) {
                showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–æ—Ç–º–µ—á–µ–Ω—ã *)', 'error');
                return;
            }

            try {
                showMessage('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ...', 'loading');
                
                // 1. –°–æ–∑–¥–∞–µ–º –∂–∏–≤–æ—Ç–Ω–æ–µ
                const response = await fetch(`${API_BASE}/animals`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                // –í createAnimal –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∂–∏–≤–æ—Ç–Ω–æ–≥–æ:
                if (response.ok) {
                    const result = await response.json();
                    console.log('Animal creation response:', result);
                    
                    // –ò–∑–≤–ª–µ–∫–∞–µ–º ID —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏
                    const animalId = result.animal?.id;
                    console.log('Extracted animal ID:', animalId);
                    
                    if (animalId) {
                        if (animalPhotos.length > 0) {
                            // –ü–ï–†–ï–î–ê–ï–ú animalId –í –§–£–ù–ö–¶–ò–Æ
                            await uploadPhotos(animalPhotos, 'animal', animalId);
                        }
                        showMessage('‚úÖ –ñ–∏–≤–æ—Ç–Ω–æ–µ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ!', 'success');
                        resetAnimalForm();
                    } else {
                        showMessage('‚ùå –û—à–∏–±–∫–∞: –Ω–µ –ø–æ–ª—É—á–µ–Ω ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ. –û—Ç–≤–µ—Ç:', animal, 'error');
                    }
                }
            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message, 'error');
            }
        }

        async function createShelter() {
            const formData = {
                name: document.getElementById('shelterName').value,
                address: document.getElementById('shelterAddress').value,
                phone: document.getElementById('shelterPhone').value,
                email: document.getElementById('shelterEmail').value,
                working_hours: document.getElementById('shelterHours').value,
                description: document.getElementById('shelterDescription').value
            };

            if (!formData.name || !formData.address) {
                showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–æ—Ç–º–µ—á–µ–Ω—ã *)', 'error');
                return;
            }

            try {
                showMessage('–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏—é—Ç–∞...', 'loading');
                
                // 1. –°–æ–∑–¥–∞–µ–º –ø—Ä–∏—é—Ç
                const response = await fetch(`${API_BASE}/shelters`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                // –í createShelter –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏—é—Ç–∞:
                if (response.ok) {
                    const result = await response.json();
                    console.log('Shelter creation response:', result);
                    
                    // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏)
                    const shelterId = result.shelter?.id || result.id;
                    console.log('Extracted shelter ID:', shelterId);
                    
                    if (shelterId) {
                        if (shelterPhotos.length > 0) {
                            await uploadPhotos(shelterPhotos, 'shelter', shelterId);
                        }
                        showMessage('‚úÖ –ü—Ä–∏—é—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!', 'success');
                        resetShelterForm();
                        loadShelters();
                    } else {
                        showMessage('‚ùå –û—à–∏–±–∫–∞: –Ω–µ –ø–æ–ª—É—á–µ–Ω ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏—é—Ç–∞', 'error');
                    }
                }
            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message, 'error');
            }
        }

        async function createUser() {
            const formData = {
                first_name: document.getElementById('userFirstName').value,
                last_name: document.getElementById('userLastName').value,
                email: document.getElementById('userEmail').value,
                phone: document.getElementById('userPhone').value,
                age: document.getElementById('userAge').value ? parseInt(document.getElementById('userAge').value) : null,
                gender: document.getElementById('userGender').value,
                address: document.getElementById('userAddress').value,
                occupation: document.getElementById('userOccupation').value,
                experience: document.getElementById('userExperience').value,
                housing_conditions: document.getElementById('userHousing').value
            };

            if (!formData.first_name || !formData.last_name || !formData.email || !formData.phone) {
                showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–æ—Ç–º–µ—á–µ–Ω—ã *)', 'error');
                return;
            }

            try {
                showMessage('–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...', 'loading');
                
                const response = await fetch(`${API_BASE}/users`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('User creation response:', result);
                    const userId = result.user?.id || result.id;
                    if (userId) {
                        showMessage('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!', 'success');
                        resetUserForm();
                    } else {
                        showMessage('‚ùå –û—à–∏–±–∫–∞: –Ω–µ –ø–æ–ª—É—á–µ–Ω ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'error');
                    }
                } else {
                    const error = await response.text();
                    console.error('‚ùå User creation failed:', error);
                    showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ' + error, 'error');
                }
            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message, 'error');
            }
        }

        async function createApplication() {
            const formData = {
                user_id: parseInt(document.getElementById('applicationUser').value),
                animal_id: parseInt(document.getElementById('applicationAnimal').value),
                shelter_id: parseInt(document.getElementById('applicationShelter').value), // –î–æ–±–∞–≤–ª—è–µ–º shelter_id
                status: document.getElementById('applicationStatus').value,
                reason: document.getElementById('applicationReason').value,
                notes: document.getElementById('applicationNotes').value
            };

            if (!formData.user_id || !formData.animal_id || !formData.status || !formData.shelter_id) { // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É shelter_id
                showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–æ—Ç–º–µ—á–µ–Ω—ã *)', 'error');
                return;
            }

            try {
                showMessage('–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏...', 'loading');
                
                const response = await fetch(`${API_BASE}/applications`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('Application creation response:', result);
                    const applicationId = result.application?.id || result.id;
                    if (applicationId) {
                        showMessage('‚úÖ –ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!', 'success');
                        resetApplicationForm();
                    } else {
                        showMessage('‚ùå –û—à–∏–±–∫–∞: –Ω–µ –ø–æ–ª—É—á–µ–Ω ID —Å–æ–∑–¥–∞–Ω–Ω–æ–π –∑–∞—è–≤–∫–∏', 'error');
                    }
                } else {
                    const error = await response.text();
                    console.error('‚ùå Application creation failed:', error);
                    showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏: ' + error, 'error');
                }
            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message, 'error');
            }
        }

        async function uploadPhotos(files, entityType, entityId) {
            console.log('=== UPLOAD PHOTOS START ===');
            console.log('Files:', files);
            console.log('Entity Type:', entityType);
            console.log('Entity ID:', entityId);
            console.log('Entity ID type:', typeof entityId);
            
            if (!entityId || isNaN(entityId)) {
                console.error('‚ùå Invalid entity ID:', entityId);
                return;
            }

            for (const [index, file] of files.entries()) {
                console.log(`Uploading photo ${index + 1}/${files.length}:`, file.name);
                
                const formData = new FormData();
                formData.append('photo', file);
                formData.append('entity_type', entityType);
                formData.append('entity_id', entityId.toString());

                // –ü—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ –≤ FormData
                for (let [key, value] of formData.entries()) {
                    console.log(`FormData: ${key} =`, value);
                }

                try {
                    const response = await fetch(`${API_BASE}/photos/upload`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    console.log('Photo upload response status:', response.status);
                    
                    if (response.ok) {
                        const result = await response.json();
                        console.log('‚úÖ Photo upload success:', result);
                    } else {
                        const error = await response.text();
                        console.error('‚ùå Photo upload failed:', error);
                    }
                } catch (error) {
                    console.error('‚ùå Photo upload error:', error);
                }
            }
            console.log('=== UPLOAD PHOTOS END ===');
        }

        function resetAnimalForm() {
            document.getElementById('animalName').value = '';
            document.getElementById('animalAge').value = '';
            document.getElementById('animalType').value = '';
            document.getElementById('animalGender').value = '';
            document.getElementById('animalWeight').value = '';
            document.getElementById('animalColor').value = '';
            document.getElementById('animalSize').value = '';
            document.getElementById('animalHealth').value = '';
            document.getElementById('animalPersonality').value = '';
            document.getElementById('animalHistory').value = '';
            document.getElementById('animalShelter').value = '';
            document.getElementById('animalPreview').innerHTML = '';
            animalPhotos = [];
        }

        function resetShelterForm() {
            document.getElementById('shelterName').value = '';
            document.getElementById('shelterAddress').value = '';
            document.getElementById('shelterPhone').value = '';
            document.getElementById('shelterEmail').value = '';
            document.getElementById('shelterHours').value = '';
            document.getElementById('shelterDescription').value = '';
            document.getElementById('shelterPreview').innerHTML = '';
            shelterPhotos = [];
        }

        function resetUserForm() {
            document.getElementById('userFirstName').value = '';
            document.getElementById('userLastName').value = '';
            document.getElementById('userEmail').value = '';
            document.getElementById('userPhone').value = '';
            document.getElementById('userAge').value = '';
            document.getElementById('userGender').value = '';
            document.getElementById('userAddress').value = '';
            document.getElementById('userOccupation').value = '';
            document.getElementById('userExperience').value = '';
            document.getElementById('userHousing').value = '';
        }

        function resetApplicationForm() {
            document.getElementById('applicationUser').value = '';
            document.getElementById('applicationAnimal').value = '';
            document.getElementById('applicationShelter').value = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–∏—é—Ç
            document.getElementById('applicationStatus').value = '';
            document.getElementById('applicationReason').value = '';
            document.getElementById('applicationNotes').value = '';
        }

        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="${type}">${text}</div>`;
            
            if (type === 'success') {
                setTimeout(() => {
                    messageDiv.innerHTML = '';
                }, 5000);
            }
        }
    </script>
</body>
</html>